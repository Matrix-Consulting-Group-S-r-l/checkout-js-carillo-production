"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[964],{44713:(e,t,n)=>{n.r(t),n.d(t,{default:()=>P});var i=n(31635),s=n(93564),r=n(30455),a=n(49655),o=n(17986),d=n(17505),l=n(95108),u=n(45293),c=n(79001),g=n(84559),m=n(74027),p=n(43586),A=n(71055),h=n(46522),f=n(68512),v=n(38989),b=n(34046),C=n(87650),y=n(35230),E=n(62562),_=n(97098),F=n(22011),S=n(33515),k=n(10685),I=n(69070),w=n(46487),M=n(4899),B=n(60833),U=n(74302),z=n(63936);const L=(0,f.A)((0,A.withFormik)({handleSubmit:function(e,t){(0,t.props.onSubmit)(e)},mapPropsToValues:function(e){var t=e.getFields,n=e.customerMessage,s=e.billingAddress;return(0,i.__assign)((0,i.__assign)({},(0,F.A)(t(s&&s.countryCode),s)),{orderComment:n})},isInitialValid:function(e){var t=e.billingAddress,n=e.getFields,i=e.language;return!!t&&(0,S.A)({language:i,formFields:n(t.countryCode)}).isValidSync(t)},validationSchema:function(e){var t=e.language,n=e.getFields;return"amazonpay"===e.methodId?(0,h.RZ)((function(e){return(0,k.A)({translate:(0,S.X)(t),formFields:n(e&&e.countryCode)})})):(0,h.RZ)((function(e){return(0,S.A)({language:t,formFields:n(e&&e.countryCode)})}))},enableReinitialize:!0})((function(e){var t,n=e.googleMapsApiKey,s=e.billingAddress,d=e.countriesWithAutocomplete,l=e.customer,u=l.addresses,c=l.isGuest,g=e.getFields,m=e.countries,p=e.isUpdating,A=e.setFieldValue,h=e.shouldShowOrderComments,f=e.values,F=e.methodId,S=e.isFloatingLabelEnabled,k=e.updateAddress,L=e.onUnhandledError,N=(0,r.useState)(!1),O=N[0],V=N[1],P=(0,r.useRef)(null),R=(0,v.A)(),K=R.isPayPalFastlaneEnabled,x=R.paypalFastlaneAddresses,D="amazonpay"===F,W=g(f.countryCode),Z=W.filter((function(e){return e.custom})),G=Z.length>0,J=D&&G?Z:W,q=K?x:u,T=(null==q?void 0:q.length)>0,X=s&&(0,C.A)(s,q,g(s.countryCode)),Y=function(e){return(0,i.__awaiter)(void 0,void 0,void 0,(function(){var t;return(0,i.__generator)(this,(function(n){switch(n.label){case 0:V(!0),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,k(e)];case 2:return n.sent(),[3,5];case 3:return(t=n.sent())instanceof Error&&L(t),[3,5];case 4:return V(!1),[7];case 5:return[2]}}))}))},j=(null===(t=null==s?void 0:s.customFields)||void 0===t?void 0:t.some((function(e){return e.fieldId==="field_"+z.O.AddressCustomFields.fattID&&"Y"===e.fieldValue})))||!1,H=J.find((function(e){return e.id==="field_"+z.O.AddressCustomFields.pIvaID}));return H&&(H.required=j),r.createElement(M.A,{autoComplete:"on"},D&&s&&r.createElement("div",{className:"form-fieldset"},r.createElement(U.A,{address:s})),r.createElement(B.A,{id:"checkoutBillingAddress",ref:P},T&&!D&&r.createElement(B.A,{id:"billingAddresses"},r.createElement(b.A,{isLoading:O},r.createElement(y.A,{addresses:q,onSelectAddress:Y,onUseNewAddress:function(){Y({})},selectedAddress:X?s:void 0,type:E.A.Billing}))),!X&&r.createElement(o.A,{isLoading:O},r.createElement(_.A,{countries:m,countriesWithAutocomplete:d,countryCode:f.countryCode,formFields:J,googleMapsApiKey:n,isFloatingLabelEnabled:S,setFieldValue:A,shouldShowSaveAddress:!c}))),h&&r.createElement(I.A,null),r.createElement("div",{className:"form-actions"},r.createElement(w.Ay,{disabled:p||O,id:"checkout-billing-continue",isLoading:p||O,type:"submit",variant:w.Ak.Primary},r.createElement(a.A,{id:"common.continue_action"}))))})));var N=n(21106);function O(e){var t=(0,N.A)(e);return t&&["amazonpay"].indexOf(t.providerId)>-1?t.providerId:void 0}var V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSubmit=function(e){return(0,i.__awaiter)(t,void 0,void 0,(function(){var t,n,s,r,a,o,u,c,g,m,p=e.orderComment,A=(0,i.__rest)(e,["orderComment"]);return(0,i.__generator)(this,(function(e){switch(e.label){case 0:t=this.props,n=t.updateAddress,s=t.updateCheckout,r=t.customerMessage,a=t.billingAddress,o=t.navigateNextStep,u=t.onUnhandledError,c=[],(g=(0,d.A)(A))&&!(0,l.A)(g,a)&&c.push(n(g)),r!==p&&c.push(s({customerMessage:p})),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,Promise.all(c)];case 2:return e.sent(),o(),[3,4];case 3:return(m=e.sent())instanceof Error&&u(m),[3,4];case 4:return[2]}}))}))},t}return(0,i.__extends)(t,e),t.prototype.componentDidMount=function(){return(0,i.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r,a,o;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,t=e.initialize,n=e.onReady,r=void 0===n?s.noop:n,a=e.onUnhandledError,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t()];case 2:return i.sent(),r(),[3,4];case 3:return(o=i.sent())instanceof Error&&a(o),[3,4];case 4:return[2]}}))}))},t.prototype.render=function(){var e=this.props,t=e.updateAddress,n=e.isInitializing,s=(0,i.__rest)(e,["updateAddress","isInitializing"]);return r.createElement(o.A,{isLoading:n},r.createElement("div",{className:"checkout-form"},r.createElement("div",{className:"form-legend-container"},r.createElement(p.A,{testId:"billing-address-heading"},r.createElement(a.A,{id:"billing.billing_address_heading"}))),r.createElement(L,(0,i.__assign)({},s,{onSubmit:this.handleSubmit,updateAddress:t}))))},t}(r.Component);const P=(0,u.A)((function(e){var t=e.checkoutService,n=e.checkoutState,i=n.data,s=i.getCheckout,r=i.getConfig,a=i.getCart,o=i.getCustomer,d=i.getBillingAddress,l=i.getBillingAddressFields,u=i.getBillingCountries,p=n.statuses,A=p.isLoadingBillingCountries,h=p.isUpdatingBillingAddress,f=p.isUpdatingCheckout,v=r(),b=o(),C=s(),y=a();if(!(v&&b&&C&&y))return null;var E=v.checkoutSettings,_=E.enableOrderComments,F=E.googleMapsApiKey;return{billingAddress:d(),countries:u()||c.M,countriesWithAutocomplete:["US","CA","AU","NZ","GB"],customer:b,customerMessage:C.customerMessage,getFields:l,googleMapsApiKey:F,initialize:t.loadBillingAddressFields,isInitializing:A(),isUpdating:h()||f(),methodId:O(C),shouldShowOrderComments:_&&(0,m.A)(y)<1,updateAddress:t.updateBillingAddress,updateCheckout:t.updateCheckout,isFloatingLabelEnabled:(0,g.A)(v.checkoutSettings)}}))(V)}}]);
//# sourceMappingURL=billing-769963b5.js.map